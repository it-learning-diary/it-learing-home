

# ğŸš ä¸€ã€å‰è¨€


- æœ¬ç¯‡æ–‡ç« é‡ç‚¹ä»‹ç»SpringBooté›†åˆMyBatiså’ŒMyBatis-Plusæ•´åˆå¤šæ•°æ®æºæ–¹é¢çš„çŸ¥è¯†ï¼

<br>


# ğŸš… äºŒã€ä¸“æ æ¨è
<br>

&emsp;&emsp;**è‰¯å¿ƒæ¨èï¼š** ä¸‹é¢çš„ç›¸å…³æŠ€æœ¯ä¸“æ è¿˜åœ¨å…è´¹åˆ†äº«å“¦ï¼Œå¤§å®¶å¯ä»¥å¸®å¿™ç‚¹ç‚¹è®¢é˜…å“¦ï¼<br>

&emsp;&emsp;[é¢è¯•å¹²è´§ä¸“æ ](https://blog.csdn.net/qq_40891009/category_11121231.html)<br>

&emsp;&emsp;[å¸¸è§å¼€å‘é—®é¢˜ä¸“æ ](https://blog.csdn.net/qq_40891009/category_9412713.html)<br>

<br>



# ğŸš” ä¸‰ã€æ•´åˆå¤šæ•°æ®æºéœ€è¦äº†è§£çš„çŸ¥è¯†
<br>

&emsp;&emsp;**1ã€ä½•æ—¶ä¼šä½¿ç”¨åˆ°å¤šæ•°æ®æº**<br>

&emsp;&emsp;ä¸€ä¸ªæŠ€æœ¯çš„å‡ºç°ã€åº”ç”¨å¿…ç„¶æ˜¯ä¸ºäº†è§£å†³å­˜åœ¨çš„æŸäº›é—®é¢˜ï¼Œå¤šæ•°æ®æºå‡ºç°å¸¸è§çš„åœºæ™¯å¦‚ä¸‹ï¼š<br>

&emsp;&emsp;**ï¼ˆ1ï¼‰ã€ä¸ç¬¬ä¸‰æ–¹å¯¹æ¥æ—¶ï¼Œæœ‰äº›åˆä½œæ–¹å¹¶ä¸ä¼šä¸ºäº†ä½ çš„æŸäº›éœ€æ±‚è€Œç»™ä½ å¼€å‘ä¸€ä¸ªåŠŸèƒ½ï¼Œä»–ä»¬å¯ä»¥æä¾›ç»™ä½ ä¸€ä¸ªå¯ä»¥è®¿é—®æ•°æ®æºçš„åªè¯»è´¦å·ï¼Œä½ éœ€è¦è·å–ä»€ä¹ˆæ•°æ®ç”±ä½ è‡ªå·±è¿›è¡Œé€»è¾‘å¤„ç†ï¼Œè¿™æ—¶å€™å°±é¿å…ä¸äº†éœ€è¦è¿›è¡Œå¤šæ•°æ®æºæ•´åˆäº†ã€‚**<br>

&emsp;&emsp;**ï¼ˆ2ï¼‰ã€ä¸šåŠ¡æ•°æ®è¾¾åˆ°äº†ä¸€ä¸ªé‡çº§ï¼Œä½¿ç”¨å•ä¸€æ•°æ®åº“å­˜å‚¨è¾¾åˆ°äº†ä¸€ä¸ªç“¶é¢ˆï¼Œéœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨ç­‰æ“ä½œè¿›è¡Œæ•°æ®ç®¡ç†ï¼Œåœ¨æ“ä½œæ•°æ®æ—¶ï¼Œä¸å¯é¿å…çš„æ¶‰åŠåˆ°å¤šæ•°æ®æºé—®é¢˜ã€‚**<br>

&emsp;&emsp;**2ã€å¤šæ•°æ®æºæ•´åˆæœ‰å“ªäº›æ–¹å¼**<br>

&emsp;&emsp;å‚è€ƒäº†ç½‘ä¸Šçš„è®¸å¤šææ–™ï¼Œå‘ç°æ•´åˆæ–¹å¼æ— å¤–ä¹ä»¥ä¸‹å‡ ç§ï¼š<br>

&emsp;&emsp;ï¼ˆ1ï¼‰ã€ä½¿ç”¨åˆ†åŒ…æ–¹å¼ï¼Œä¸åŒçš„æ•°æ®æºé…ç½®ä¸åŒçš„MapperScanå’Œmapperæ–‡ä»¶<br>

&emsp;&emsp;ï¼ˆ2ï¼‰ã€ä½¿ç”¨APOåˆ‡ç‰‡æ–¹å¼ï¼Œå®ç°åŠ¨æ€æ•°æ®æºåˆ‡æ¢(å¦‚æœå¯¹Aopä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæ¬¢è¿æŸ¥çœ‹æˆ‘ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ï¼Œè¿™çŸ¥è¯†ä¿ç†Ÿå“¦ï¼ã€[ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹?](https://blog.csdn.net/qq_40891009/article/details/119843599?spm=1001.2014.3001.5501)ã€‘)<br>

&emsp;&emsp;ï¼ˆ3ï¼‰ã€ä½¿ç”¨æ•°æ®åº“ä»£ç†ä¸­é—´ä»¶ï¼Œå¦‚Mycatç­‰<br>

&emsp;&emsp;**3ã€ä¸åŒæ–¹å¼ä¹‹é—´çš„åŒºåˆ«**<br>

&emsp;&emsp;ï¼ˆ1ï¼‰ã€åˆ†åŒ…æ–¹å¼å¯ä»¥é›†åˆJTA(JAVA Transactional API)å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†æ˜¯æ•´ä¸ªæµç¨‹çš„å®ç°ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤æ‚ã€‚<br>

&emsp;&emsp;ï¼ˆ2ï¼‰ã€AOPåŠ¨æ€é…ç½®æ•°æ®æºæ–¹å¼ç¼ºç‚¹åœ¨äºæ— æ³•å®ç°å…¨å±€åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ‰€ä»¥å¦‚æœåªæ˜¯å¯¹æ¥ç¬¬ä¸‰æ–¹æ•°æ®æºï¼Œä¸æ¶‰åŠåˆ°éœ€è¦ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„è¯ï¼Œæ˜¯å¯ä»¥ä½œä¸ºä¸€ç§é€‰æ‹©ã€‚<br>

&emsp;&emsp;ï¼ˆ3ï¼‰ã€**ä½¿ç”¨æ•°æ®åº“ä»£ç†ä¸­é—´ä»¶æ–¹å¼æ˜¯ç°åœ¨æ¯”è¾ƒæµè¡Œçš„ä¸€ç§æ–¹å¼ï¼Œå¾ˆå¤šå¤§å‚ä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼**ï¼Œå¼€å‘è€…ä¸éœ€è¦å…³æ³¨å¤ªå¤šä¸ä¸šåŠ¡æ— å…³çš„é—®é¢˜ï¼ŒæŠŠå®ƒä»¬éƒ½äº¤ç»™æ•°æ®åº“ä»£ç†ä¸­é—´ä»¶å»å¤„ç†ï¼Œå¤§é‡çš„é€šç”¨çš„æ•°æ®èšåˆï¼Œäº‹åŠ¡ï¼Œæ•°æ®æºåˆ‡æ¢éƒ½ç”±ä¸­é—´ä»¶æ¥å¤„ç†ï¼Œä¸­é—´ä»¶çš„æ€§èƒ½ä¸å¤„ç†èƒ½åŠ›å°†ç›´æ¥å†³å®šåº”ç”¨çš„è¯»å†™æ€§èƒ½ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰Mycatã€TDDLç­‰ã€‚**ç°åœ¨é˜¿é‡Œå‡ºäº†100%è‡ªç ”çš„åˆ†å¸ƒå¼æ•°æ®åº“OceanBaseï¼Œä»æœ€åº•å±‚æ”¯æŒåˆ†å¸ƒå¼ï¼Œæ€§èƒ½ä¹Ÿéå¸¸å¼ºå¤§ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥å»äº†è§£ä¸‹ï¼**<br>

&emsp;&emsp;**4ã€æœ¬æ–‡å®æˆ˜é€‰æ‹©çš„æ–¹å¼**<br>

&emsp;&emsp;é‰´äºæœ¬æ¬¡é‡åˆ°éœ€æ±‚çš„æ•´åˆå¤šæ•°æ®æºçš„åœºæ™¯æ˜¯éœ€è¦ **å¯¹æ¥ç¬¬ä¸‰æ–¹çš„æ•°æ®**ï¼Œæš‚ä¸æ¶‰åŠåˆ°åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ ï¼Œ**æ‰€ä»¥æœ¬æ–‡å®æˆ˜æ•´åˆå¤šæ•°æ®æºä½¿ç”¨çš„æ–¹å¼æ˜¯ã€åˆ†åŒ…æ–¹å¼ã€‘å®ç°ç®€å•çš„å¤šæ•°æ®æºæ•´åˆï¼Œè‡³äºå…¶ä»–æ–¹å¼å’Œåˆ†å¸ƒå¼äº‹åŠ¡çš„å‘ï¼Œåé¢å†æ…¢æ…¢å¡«å§(o(â•¥ï¹â•¥)o)ï¼**<br>


<br>

# ğŸš¢ å››ã€SpringBoot+MyBatisæ•´åˆå¤šæ•°æ®æº
<br>

## ğŸ”´ 4.1 è¯´æ˜
<br>

&emsp;&emsp;æœ¬æ¬¡æ¡ˆä¾‹æ¶‰åŠåˆ°çš„ä»£ç æ¯”è¾ƒå¤šï¼Œå› æ­¤æ–‡ç« åªè´´å‡ºéƒ¨åˆ†ï¼Œå…¨éƒ¨æ¡ˆä¾‹ä»£ç å·²ç»ä¸Šä¼ åˆ°Giteeï¼Œéœ€è¦è€…å¯ç›´æ¥è®¿é—®ï¼šã€[SpringBootç»“åˆMyBatisæ•´åˆå¤šæ•°æ®æº](https://gitee.com/it-learning-diary/multi-datasource-instance)ã€‘ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š
<br>

<center><img src="https://img-blog.csdnimg.cn/fd1ee2a6c03e4cdaaf1809869f1eceeb.png" /></center>

<br>


## ğŸŸ  4.2 æ¶‰åŠä¾èµ–åŒ…
<br>


> - spring-boot-starter-web -- webç›¸å…³æ”¯æŒ<br>
> - mybatis-spring-boot-starter -- springbootæ•´åˆmybatisä¾èµ– <br>
> - mysql-connector-java -- mysqlæ•°æ®é©±åŠ¨<br>
> - lombok -- è‡ªåŠ¨ç”Ÿæˆå®ä½“ç±»å¸¸ç”¨æ–¹æ³•ä¾èµ–åŒ…<br>
> - hutool-all -- å¸¸ç”¨æ–¹æ³•å°è£…ä¾èµ–åŒ…

<br>

```java

<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>2.2.0</version>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>8.0.13</version>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>cn.hutool</groupId>
            <artifactId>hutool-all</artifactId>
            <version>5.4.5</version>
        </dependency>
 ```

<br>

## ğŸŸ¡ 4.3 é¡¹ç›®é…ç½®
<br>

```java
# é¡¹ç›®å¯åŠ¨ç«¯å£
server:
  port: 9090

# é¡¹ç›® åç§°
spring:
  application:
    name: multi-datasource-instance
  datasource:
    # ä¸»æ•°æ®åº“
    master:
      # æ³¨æ„ï¼Œæ•´åˆå¤šæ•°æ®æºæ—¶å¦‚æœä½¿ç”¨springbooté»˜è®¤çš„æ•°æ®åº“è¿æ¥æ± Hikariï¼ŒæŒ‡å®šè¿æ¥æ•°æ®ä½¿ç”¨çš„æ˜¯jdbc-urlè€Œä¸æ˜¯urlå±æ€§
      jdbc-url: jdbc:mysql://localhost:3306/test1?serverTimezone=UTC&useUnicode=true&characterEncoding=utf8&useSSL=false
      username: root
      password: 123456
      driver-class-name: com.mysql.cj.jdbc.Driver
    # å‰¯æ•°æ®åº“
    slave:
      # æ³¨æ„ï¼Œæ•´åˆå¤šæ•°æ®æºæ—¶å¦‚æœä½¿ç”¨springbooté»˜è®¤çš„æ•°æ®åº“è¿æ¥æ± Hikariï¼ŒæŒ‡å®šè¿æ¥æ•°æ®ä½¿ç”¨çš„æ˜¯jdbc-urlè€Œä¸æ˜¯urlå±æ€§
      jdbc-url: jdbc:mysql://localhost:3306/test2?serverTimezone=UTC&useUnicode=true&characterEncoding=utf8&useSSL=false
      username: root
      password: 123456
      driver-class-name: com.mysql.cj.jdbc.Driver
```
<br>

## ğŸŸ¢ 4.4 ç¼–å†™ä¸»å‰¯æ•°æ®åº“æ•°æ®æºé…ç½®
<br>

&emsp;&emsp;1ã€ä¸»æ•°æ®æºç›¸å…³é…ç½®ï¼šä¸»è¦æ˜¯æŒ‡å®šä¸»æ•°æ®æºã€æ‰«æçš„mapperåœ°å€ã€äº‹åŠ¡ç®¡ç†å™¨ç­‰ä¿¡æ¯ã€‚
<br>

```java
@Configuration
// æŒ‡å®šä¸»æ•°æ®åº“æ‰«æå¯¹åº”çš„Mapperæ–‡ä»¶ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡
@MapperScan(basePackages ="com.diary.it.multi.datasource.mapper" ,sqlSessionFactoryRef = "masterSqlSessionFactory")
public class MasterDataSourceConfig {

    // mapper.xmlæ‰€åœ¨åœ°å€
    private static final String MAPPER_LOCATION = "classpath*:mapper/*.xml";


    /**
     * ä¸»æ•°æ®æºï¼ŒPrimaryæ³¨è§£å¿…é¡»å¢åŠ ï¼Œå®ƒè¡¨ç¤ºè¯¥æ•°æ®æºä¸ºé»˜è®¤æ•°æ®æº
     * é¡¹ç›®ä¸­è¿˜å¯èƒ½å­˜åœ¨å…¶ä»–çš„æ•°æ®æºï¼Œå¦‚è·å–æ—¶ä¸æŒ‡å®šåç§°ï¼Œåˆ™é»˜è®¤è·å–è¿™ä¸ªæ•°æ®æºï¼Œå¦‚æœä¸æ·»åŠ ï¼Œåˆ™å¯åŠ¨æ—¶å€™å›æŠ¥é”™
     */
    @Primary
    @Bean(name = "masterDataSource")
    // è¯»å–spring.datasource.masterå‰ç¼€çš„é…ç½®æ–‡ä»¶æ˜ å°„æˆå¯¹åº”çš„é…ç½®å¯¹è±¡
    @ConfigurationProperties(prefix = "spring.datasource.master")
    public DataSource dataSource() {
        DataSource build = DataSourceBuilder.create().build();
        return build;
    }

    /**
     * äº‹åŠ¡ç®¡ç†å™¨ï¼ŒPrimaryæ³¨è§£ä½œç”¨åŒä¸Š
     */
    @Bean(name = "masterTransactionManager")
    @Primary
    public PlatformTransactionManager dataSourceTransactionManager(@Qualifier("masterDataSource") DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }

    /**
     * sessionå·¥å‚ï¼ŒPrimaryæ³¨è§£ä½œç”¨åŒä¸Š
     */

    @Bean(name = "masterSqlSessionFactory")
    @Primary
    public SqlSessionFactory sqlSessionFactory(@Qualifier("masterDataSource") DataSource dataSource) throws Exception {
        final SqlSessionFactoryBean sessionFactoryBean = new SqlSessionFactoryBean();
        sessionFactoryBean.setDataSource(dataSource);
        sessionFactoryBean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(MasterDataSourceConfig.MAPPER_LOCATION));
        return sessionFactoryBean.getObject();
    }

}
```

<br>

&emsp;&emsp;`2ã€å‰¯æ•°æ®æºç›¸å…³é…ç½®ï¼šä¸»è¦æ˜¯æŒ‡å®šæ•°æ®æºã€æ‰«æçš„mapperåœ°å€ã€äº‹åŠ¡ç®¡ç†å™¨ç­‰ä¿¡æ¯ã€‚
<br>

```java

@Configuration
// æŒ‡å®šä»æ•°æ®åº“æ‰«æå¯¹åº”çš„Mapperæ–‡ä»¶ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡
@MapperScan(basePackages = "com.diary.it.multi.datasource.mapper2", sqlSessionFactoryRef = "slaveSqlSessionFactory")
public class SlaveDataSourceConfig {
    // mapper.xmlæ‰€åœ¨åœ°å€
    private static final String MAPPER_LOCATION = "classpath*:mapper2/*.xml";

    /**
     * æ•°æ®æº
     */
    @Bean(name = "slaveDataSource")
    // è¯»å–spring.datasource.slaveå‰ç¼€çš„é…ç½®æ–‡ä»¶æ˜ å°„æˆå¯¹åº”çš„é…ç½®å¯¹è±¡
    @ConfigurationProperties(prefix = "spring.datasource.slave")
    public DataSource dataSource() {
        DataSource build = DataSourceBuilder.create().build();
        return build;
    }


    /**
     * äº‹åŠ¡ç®¡ç†å™¨
     */
    @Bean(name = "slaveTransactionManager")
    public PlatformTransactionManager dataSourceTransactionManager(@Qualifier("slaveDataSource") DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }

    /**
     * sessionå·¥å‚
     */

    @Bean(name = "slaveSqlSessionFactory")
    public SqlSessionFactory sqlSessionFactory(@Qualifier("slaveDataSource") DataSource dataSource) throws Exception {
        final SqlSessionFactoryBean sessionFactoryBean = new SqlSessionFactoryBean();
        sessionFactoryBean.setDataSource(dataSource);
        sessionFactoryBean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(SlaveDataSourceConfig.MAPPER_LOCATION));
        return sessionFactoryBean.getObject();
    }

}

```

<br>

## ğŸ”µ 4.5 æ‰§è¡Œç»“æœ
<br>

&emsp;&emsp;å®Œæˆä¸Šé¢çš„æ­¥éª¤åï¼Œå°±è·Ÿæˆ‘ä»¬å¹³å¸¸å†™ä¸šåŠ¡é€»è¾‘çš„æ–¹å¼ä¸€æ ·ï¼Œåœ¨serviceä¸­å†™ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨mapperä¸­å†™sqlè¯­å¥ç­‰ï¼Œä¸‹é¢çœ‹çœ‹æ‰§è¡Œç»“æœï¼
<br>

<center><img src="https://img-blog.csdnimg.cn/5a55378c3bc647f4800d9d31821c61d6.png" /></center>


<br>

## ğŸŸ£ 4.6 æ•´åˆä¸­é‡åˆ°çš„é—®é¢˜
<br>

&emsp;&emsp;çœ‹å®Œä¸Šé¢çš„æ•™ç¨‹ï¼Œæ˜¯ä¸æ˜¯å‘ç°å…¶å®æ•´åˆå¤šæ•°æ®æºå…¶å®ä¹ŸæŒºç®€å•çš„ï¼**ä½†æ˜¯ï¼Œå®Œå…¨æŒ‰ç…§æ•™å­¦æµç¨‹æ•´åˆè¿˜æ˜¯é‡åˆ°å„ç§é—®é¢˜çš„ç°è±¡çœŸçš„å¤ªå¸¸è§äº†ï¼Œä¸‹é¢åšä¸»å°±æ€»ç»“ä¸‹æ•´åˆä¸­é‡åˆ°çš„å„ç§é—®é¢˜**ï¼Œå¦‚æœä½ åœ¨æ•´åˆè¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†ï¼Œå¯ä»¥ç›´æ¥æŒ‰ç…§åšä¸»çš„è§£å†³æ–¹æ¡ˆæ¥å“¦(è´´å¿ƒå§ï¼)ã€‚<br>

&emsp;&emsp;**é—®é¢˜1ã€å‡ºç° jdbcUrl is required with driverClassNameå¼‚å¸¸** <br>

&emsp;&emsp;**åŸå› ï¼š** SpringBoot2.xåé»˜è®¤çš„æ•°æ®åº“è¿æ¥æ± å°±æ˜¯HikariCP(å·ç§°å²ä¸Šæœ€å¿«ï¼Œæ€§èƒ½æœ€é«˜)ï¼Œ**`HikariCPè¿æ¥æ± ä¸­å‘½åè§„åˆ™å’Œå…¶ä»–çš„è¿æ¥æ± ä¸å¤ªä¸€æ ·ï¼ŒæŒ‡å®šè¿æ¥æ•°æ®åº“çš„åœ°å€æ—¶ï¼Œå®ƒä½¿ç”¨çš„æ˜¯jdbc-urlè€Œä¸æ˜¯urlï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šæ•°æ®åº“è¿æ¥æ± å¦‚druidè€Œä½¿ç”¨springbooté»˜è®¤çš„è¿æ¥æ± çš„è¯ï¼Œéœ€è¦å°†é…ç½®ä¸­è¿æ¥æ•°æ®åº“çš„urlæ”¹æˆjdbc-urlå±æ€§ã€‚**<br>

&emsp;&emsp;**é—®é¢˜2ã€ å‡ºç° Invalid bound statement (not found)å¼‚å¸¸**<br>

&emsp;&emsp;**åŸå› ï¼š**  <br>

&emsp;&emsp;&emsp;&emsp;ï¼ˆ1ï¼‰ã€åœ¨å®šä¹‰æ•°æ®æºé…ç½®ä¿¡æ¯æ—¶æ²¡æœ‰æŒ‡å®šSqlSessionFactoryBeanæ‰«æçš„mapper.xmlæ–‡ä»¶çš„ä½ç½®å³ sessionFactoryBean.setMapperLocations(xxx)ã€‚<br>

&emsp;&emsp;&emsp;&emsp;ï¼ˆ2ï¼‰ã€mapper.xmlæ–‡ä»¶ä¸­namespaceå±æ€§å¯¹åº”çš„è·¯å¾„ä¸å‡†ç¡®æˆ–è€…å¯¹åº”æ–¹æ³•çš„idåç§°ã€parameterTypeå±æ€§ä¸å¯¹<br>

&emsp;&emsp;&emsp;&emsp;ï¼ˆ3ï¼‰ã€xxxMapper.javaçš„æ–¹æ³•è¿”å›å€¼æ˜¯List,è€Œselectå…ƒç´ æ²¡æœ‰æ­£ç¡®é…ç½®ResultMap,æˆ–è€…åªé…ç½®ResultType<br>

&emsp;&emsp;**é—®é¢˜3ã€  å‡ºç° required a single bean, but 2 were foundå¼‚å¸¸**<br>

&emsp;&emsp;**åŸå› ï¼š**  å› ä¸ºæˆ‘ä»¬åœ¨æŒ‡å®šä¸»å‰¯æ•°æ®æºé…ç½®æ—¶å·²ç»ä½¿ç”¨MapperScanæ³¨è§£è¿›è¡Œæ‰«æå¯¹åº”çš„mapper.javaï¼Œæ­¤æ—¶è¢«æ‰«æåˆ°çš„mapper.javaå·²ç»ç”Ÿæˆä»£ç†ç±»åˆ°Springå®¹å™¨ï¼Œå¦‚æœæ­¤æ—¶åœ¨å¯åŠ¨ç±»ä¸­å†ä½¿ç”¨MapperScanæ‰«æåˆ™ä¼šæˆå‡ºç°ä¸Šé¢çš„é—®é¢˜(**å¥‡æ€ªçš„æ˜¯ï¼šè¿™ä¸ªé—®é¢˜æˆ‘æ¢ä¸€å°ç”µè„‘å°±ä¸æŠ¥é”™äº†ï¼Œæ‰€ä»¥å‡ºç°è¿™ä¸ªé—®é¢˜å…ˆæŒ‰ç…§è¿™ä¸ªæ–¹æ¡ˆè§£å†³å§**)<br>

&emsp;&emsp;**é—®é¢˜4ã€  ä¸»æ•°æ®æºé…ç½®ç±»ä¸­ä¸ºä»€ä¹ˆæ·»åŠ Primaryæ³¨è§£**<br>

&emsp;&emsp;**åŸå› ï¼š** å› ä¸ºæ•´åˆäº†å¤šæ•°æ®æºï¼Œæ‰€ä»¥DataSourceã€PlatformTransactionManagerç­‰å®ä¾‹éƒ½ä¼šæ³¨å…¥å¤šä¸ªåˆ°Springå®¹å™¨ä¸­ï¼ŒPrimaryæ³¨è§£çš„ä½œç”¨å°±æ˜¯ï¼š**å½“æˆ‘ä»¬ä½¿ç”¨è‡ªåŠ¨é…ç½®çš„æ–¹å¼å¦‚Autowiredæ³¨å…¥Beanæ—¶ï¼Œå¦‚æœè¿™ä¸ªBeanæœ‰å¤šä¸ªå€™é€‰è€…ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªå€™é€‰è€…å…·æœ‰@Primaryæ³¨è§£ä¿®é¥°ï¼Œè¯¥å€™é€‰è€…ä¼šè¢«é€‰ä¸­ï¼Œä½œä¸ºè‡ªåŠ¨é…ç½®çš„å€¼ã€‚**<br>

&emsp;&emsp;**é—®é¢˜5ã€  com.mysql.jdbc.Driver å’Œ com.mysql.cj.jdbc.Driverçš„åŒºåˆ«**<br>

&emsp;&emsp;**åŸå› ï¼š** ç»†å¿ƒçš„å°ä¼™ä¼´ä¼šå‘ç°ï¼Œåœ¨æ•°æ®åº“é…ç½®ä¸­driver-class-nameå±æ€§çš„å€¼ä¸ºcom.mysql.cj.jdbc.Driverï¼Œ**å…¶å®com.mysql.jdbc.Driver æ˜¯ å¯¹åº”mysql-connector-java 5é©±åŠ¨çš„ï¼Œcom.mysql.cj.jdbc.Driver æ˜¯ mysql-connector-java 6åŠä¹‹åçš„æ•°æ®åº“é©±åŠ¨çš„**ï¼Œå¦‚æœä½¿ç”¨äº†6.xåçš„mysqlæ•°æ®åº“é©±åŠ¨è¿˜ç»§ç»­ä½¿ç”¨com.mysql.jdbc.Driver åˆ™å¯åŠ¨æ—¶ä¼šæŠ¥deprecated(è¿‡æ—¶çš„)ï¼ŒåŒæ—¶ä½¿ç”¨mysql6.xåçš„é©±åŠ¨éœ€è¦æŒ‡å®šæ—¶åŒºserverTimezone:


<br>

# ğŸš² äº”ã€SpringBoot+Mybatis-Plusæ•´åˆå¤šæ•°æ®æº
<br>

&emsp;&emsp;ä¸Šé¢Mybatisä½¿ç”¨åˆ†åŒ…çš„æ–¹å¼æ•´åˆå¤šæ•°æ®æºå¤šå°‘è¿˜æ˜¯æœ‰äº›éº»çƒ¦çš„ï¼Œä½†æ˜¯ä½¿ç”¨MyBatis-Pluså°±æ¯”è¾ƒç®€å•äº†ï¼Œ**MyBatis-Pluså®˜æ–¹å°±æ”¯æŒäº†å¤šæ•°æ®æºï¼Œä½¿ç”¨çš„æ—¶å€™åªéœ€è¦ä¸€ä¸ªæ³¨è§£å°±å¯ä»¥å®ç°ï¼Œæ•´åˆå¤šæ•°æ®æºçš„æ—¶å€™æ¨èä½¿ç”¨è¯¥ç§æ–¹å¼ã€‚**
<br>

## ğŸŸ¥ 5.1 è¯´æ˜
<br>

&emsp;&emsp;æœ¬æ¬¡æ¡ˆä¾‹æ¶‰åŠåˆ°çš„ä»£ç æ¯”è¾ƒå¤šï¼Œå› æ­¤æ–‡ç« åªè´´å‡ºéƒ¨åˆ†ï¼Œå…¨éƒ¨æ¡ˆä¾‹ä»£ç å·²ç»ä¸Šä¼ åˆ°Giteeï¼Œéœ€è¦è€…å¯ç›´æ¥è®¿é—®ï¼šã€[å®æˆ˜-SpringBootç»“åˆMyBatis-Plusæ•´åˆå¤šæ•°æ®æº](https://gitee.com/it-learning-diary/multi-datasource-instance2)ã€‘ï¼Œ**[mybatis-pluså¤šæ•°æ®æºæ”¯æŒ](https://mp.baomidou.com/guide/dynamic-datasource.html#%E6%96%87%E6%A1%A3-documentation)**ï¼š
<br>

<center><img src="https://img-blog.csdnimg.cn/9bac010989c54e4183589f2142aba6cb.png" /></center>

<br>

&emsp;&emsp;**é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š**
<br>

<center><img src="https://img-blog.csdnimg.cn/2ae7466f17cb41ce9d9644a8dad5fd6c.png" /></center>

<br>

## ğŸŸ§ 5.2 æ¶‰åŠçš„ä¾èµ–åŒ…
<br>


> - spring-boot-starter-web -- webç›¸å…³æ”¯æŒ
> - mybatis-plus-boot-starter-- springbootæ•´åˆmybatis-plusä¾èµ– 
> - dynamic-datasource-spring-boot-starter -- mybatis-plusç®¡ç†æ•°æ®æºä¾èµ–
> - mysql-connector-java -- mysqlæ•°æ®é©±åŠ¨
> - lombok -- è‡ªåŠ¨ç”Ÿæˆå®ä½“ç±»å¸¸ç”¨æ–¹æ³•ä¾èµ–åŒ…
> - hutool-all -- å¸¸ç”¨æ–¹æ³•å°è£…ä¾èµ–åŒ…

<br>

```java
<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <scope>runtime</scope>
        </dependency>

        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>dynamic-datasource-spring-boot-starter</artifactId>
            <version>3.4.1</version>
        </dependency>

        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
            <version>3.4.3</version>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>cn.hutool</groupId>
            <artifactId>hutool-all</artifactId>
            <version>5.4.5</version>
        </dependency>
```

<br>

## ğŸŸ¨ 5.3 ç›¸å…³é…ç½®
<br>

```java
# å¯åŠ¨ç«¯å£
server:
  port: 9091

# é¡¹ç›®åç§°
spring:
  application:
    name: multi-datasource-instance2
  datasource:
    # é‡‡ç”¨åŠ¨æ€é€‰å–
    dynamic:
      primary: master #è®¾ç½®é»˜è®¤çš„æ•°æ®æºæˆ–è€…æ•°æ®æºç»„,é»˜è®¤å€¼å³ä¸ºmaster
      strict: false #ä¸¥æ ¼åŒ¹é…æ•°æ®æº,é»˜è®¤false. trueæœªåŒ¹é…åˆ°æŒ‡å®šæ•°æ®æºæ—¶æŠ›å¼‚å¸¸,falseä½¿ç”¨é»˜è®¤æ•°æ®æº
      datasource:
        # ä¸»æ•°æ®åº“
        master:
          url: jdbc:mysql://localhost:3306/test1?serverTimezone=UTC&useUnicode=true&characterEncoding=utf8&useSSL=false
          username: root
          password: 123456
          driver-class-name: com.mysql.cj.jdbc.Driver
        # å‰¯æ•°æ®åº“
        slave:
          url: jdbc:mysql://localhost:3306/test2?serverTimezone=UTC&useUnicode=true&characterEncoding=utf8&useSSL=false
          username: root
          password: 123456
          driver-class-name: com.mysql.cj.jdbc.Driver
```

<br>

## ğŸŸ© 5.4 ä½¿ç”¨æ–¹å¼
<br>

<center><img src="https://img-blog.csdnimg.cn/2a31485fb2a041df8a91858dd9c1e103.png" /></center>


<br>

## ğŸŸ¦ 5.5 æ‰§è¡Œç»“æœ
<br>

<center><img src="https://img-blog.csdnimg.cn/7ddc90c0177943ab83a19435106c2dfd.png" /></center>



<br>

# ğŸš€ å…­ã€å†™åœ¨æœ€å
<br>

&emsp;&emsp;**æ–‡ç« ä¸­æ‰€æœ‰ä»£ç éƒ½å·²ä¸Šä¼ åˆ°Giteeï¼Œæœ‰éœ€è¦å¯ä»¥è‡ªå–(åé¢ä¼šä¼ åˆ°CSDNå…è´¹ä¸‹è½½)ï¼Œå¦‚æœæœ‰å¸®åŠ©ä¸è¦å¿˜äº†starå“¦ï¼Œåé¢ä¼šæœ‰æ›´å¤šå®æˆ˜æ–‡ç« (é¡ºä¾¿é€éœ²ä¸‹ä¸‹ç¯‡æ–‡ç« æ˜¯ï¼šå…³äºFtpæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨å’Œä¸‹è½½åˆ°æœ¬åœ°çš„å®æˆ˜)ï¼ŒGiteeé¡¹ç›®ç›´é€šè½¦å¦‚ä¸‹ï¼š**<br>

&emsp;&emsp;[1ã€SpringBoot+MyBatisæ•´åˆå¤šæ•°æ®æº](https://gitee.com/it-learning-diary/multi-datasource-instance)<br>

&emsp;&emsp;[2ã€SpringBoot+MyBatis-Plusæ•´åˆå¤šæ•°æ®æº](https://gitee.com/it-learning-diary/multi-datasource-instance2)<br>

